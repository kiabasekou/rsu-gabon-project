# ===================================================================
# RSU GABON - INTÉGRATION SERVICES APP DANS ARCHITECTURE EXISTANTE
# Standards Top 1% - Continuité avec Core + Identity Apps
# ===================================================================



# apps/services_app/tests/test_vulnerability_service.py
from django.test import TestCase
from apps.identity_app.models import PersonIdentity
from ..services.vulnerability_service import VulnerabilityService

class VulnerabilityServiceTest(TestCase):
    def setUp(self):
        self.service = VulnerabilityService()
        
        # Création personne test
        self.person = PersonIdentity.objects.create(
            first_name="Marie",
            last_name="NGOUA",
            age=32,
            gender='F',
            province='OGOOUE_IVINDO',
            phone_number='+24106123456'
        )
    
    def test_calculate_assessment_success(self):
        """Test calcul assessment réussi"""
        assessment = self.service.calculate_and_save_assessment(self.person.id)
        
        self.assertIsNotNone(assessment)
        self.assertGreaterEqual(assessment.global_score, 0)
        self.assertLessEqual(assessment.global_score, 100)
        self.assertIn(assessment.vulnerability_level, ['CRITICAL', 'HIGH', 'MODERATE', 'LOW'])
    
    def test_bulk_calculate(self):
        """Test calcul en lot"""
        person_ids = [self.person.id]
        results = self.service.bulk_calculate_assessments(person_ids)
        
        self.assertEqual(results['success'], 1)
        self.assertEqual(results['errors'], 0)

print("✅ INTÉGRATION SERVICES APP PRÊTE")
print("📁 Structure: apps/services_app/")
print("🔗 APIs: /api/v1/services/")
print("🧪 Tests: Inclus")
print("🚀 Prêt pour déploiement")